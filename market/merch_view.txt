CREATE OR REPLACE VIEW merch_view AS SELECT market_merch.*,
                market_merchcolor.color,
                market_merchmaterial.material,
                market_merchmaterial.price_coef,
                market_merchsize.size as size,
                market_merchsize.in_cart from market_merch
INNER JOIN market_merchcolor
ON market_merch.id=market_merchcolor.merch_id
INNER JOIN market_merchmaterial
ON market_merchcolor.id=market_merchmaterial.color_id
INNER JOIN market_merchsize
ON market_merchmaterial.id=market_merchsize.material_id;


CREATE OR REPLACE VIEW whole_msg_view AS SELECT DISTINCT message_idnr, physmessage_id, seen_flag, string_agg(data, '\012\011') 
OVER (PARTITION BY physmessage_id) AS data
FROM messages_view
ORDER BY physmessage_id;
